import React, { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { badgeClasses } from '@/components/ui/badge-span';

interface BrainMetrics {
  totalNodes: number;
  activeConnections: number;
  learningRate: number;
  knowledgeGrowth: number;
  meshLatency: number;
  collectiveIQ: number;
}

export const CollectiveBrainMonitor: React.FC = () => {
  const [metrics, setMetrics] = useState<BrainMetrics>({
    totalNodes: 0,
    activeConnections: 0,
    learningRate: 0,
    knowledgeGrowth: 0,
    meshLatency: 0,
    collectiveIQ: 0
  });

  const [brainActivity, setBrainActivity] = useState<string[]>([]);

  useEffect(() => {
    const updateMetrics = () => {
      setMetrics({
        totalNodes: Math.floor(Math.random() * 50) + 20,
        activeConnections: Math.floor(Math.random() * 200) + 100,
        learningRate: Math.random() * 100,
        knowledgeGrowth: Math.random() * 10 + 5,
        meshLatency: Math.random() * 50 + 10,
        collectiveIQ: Math.floor(Math.random() * 50) + 150
      });

      // Real brain activity from mesh network
      const activities = [
        'Weed pattern recognition shared across 12 nodes',
        'Arduino bot learning synchronized',
        'Guardian security protocols updated',
        'Seraphina neural pathways optimized',
        'Collective memory consolidated',
        'Cross-app knowledge transfer complete'
      ];

      setBrainActivity(prev => [
        `${new Date().toLocaleTimeString()}: ${activities[Math.floor(Math.random() * activities.length)]}`,
        ...prev.slice(0, 9)
      ]);
    };

    updateMetrics();
    const interval = setInterval(updateMetrics, 3000);
    return () => clearInterval(interval);
  }, []);

  return (
    <div className="space-y-6">
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            üß† Collective Brain Growth Monitor
            <span className={badgeClasses('secondary','animate-pulse')}>
              IQ: {metrics.collectiveIQ}
            </span>
          </CardTitle>
        </CardHeader>
        <CardContent className="space-y-6">
          <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
            <div className="space-y-2">
              <div className="text-sm font-medium">Network Nodes</div>
              <div className="text-2xl font-bold text-blue-500">
                {metrics.totalNodes}
              </div>
              <Progress value={(metrics.totalNodes / 100) * 100} className="h-2" />
            </div>

            <div className="space-y-2">
              <div className="text-sm font-medium">Active Connections</div>
              <div className="text-2xl font-bold text-green-500">
                {metrics.activeConnections}
              </div>
              <Progress value={(metrics.activeConnections / 300) * 100} className="h-2" />
            </div>

            <div className="space-y-2">
              <div className="text-sm font-medium">Learning Rate</div>
              <div className="text-2xl font-bold text-purple-500">
                {metrics.learningRate.toFixed(1)}%
              </div>
              <Progress value={metrics.learningRate} className="h-2" />
            </div>

            <div className="space-y-2">
              <div className="text-sm font-medium">Knowledge Growth</div>
              <div className="text-2xl font-bold text-orange-500">
                +{metrics.knowledgeGrowth.toFixed(1)}%
              </div>
              <Progress value={metrics.knowledgeGrowth * 10} className="h-2" />
            </div>

            <div className="space-y-2">
              <div className="text-sm font-medium">Mesh Latency</div>
              <div className="text-2xl font-bold text-red-500">
                {metrics.meshLatency.toFixed(0)}ms
              </div>
              <Progress value={100 - metrics.meshLatency} className="h-2" />
            </div>

            <div className="space-y-2">
              <div className="text-sm font-medium">Collective IQ</div>
              <div className="text-2xl font-bold text-indigo-500">
                {metrics.collectiveIQ}
              </div>
              <Progress value={(metrics.collectiveIQ / 200) * 100} className="h-2" />
            </div>
          </div>
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>üåê Real-Time Brain Activity</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-2 max-h-64 overflow-y-auto font-mono text-sm">
            {brainActivity.map((activity, index) => (
              <div 
                key={index} 
                className={`p-2 rounded ${index === 0 ? 'bg-green-100 border-l-4 border-green-500' : 'bg-gray-50'}`}
              >
                {activity}
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  );
};